[tox]
envlist = py312,py313,mypy,pyright,coverage,hacs
skipsdist = True

[testenv]
description = Run unit tests with pytest
deps =
    pytest>=7.0.0
    pytest-asyncio>=0.21.0
    pytest-cov>=4.0.0
    pytest-homeassistant-custom-component>=0.13.0
    pytest-timeout>=2.1.0
    homeassistant>=2024.1.0
    nwp500-python==5.0.2
    awsiotsdk>=1.25.0
skip_install = True
commands =
    pytest {posargs:tests/}

[testenv:py312]
description = Run tests on Python 3.12
basepython = python3.12

[testenv:py313]
description = Run tests on Python 3.13
basepython = python3.13

[testenv:mypy]
description = Run mypy type checking
deps =
    mypy>=1.0.0
    homeassistant>=2024.1.0
    nwp500-python==5.0.2
    awsiotsdk>=1.25.0
skip_install = True
commands =
    mypy --config-file mypy.ini custom_components/nwp500

[testenv:pyright]
description = Run pyright type checking
deps =
    pyright>=1.1.0
    homeassistant>=2024.1.0
    nwp500-python==5.0.2
    awsiotsdk>=1.25.0
skip_install = True
commands =
    pyright custom_components/nwp500

[testenv:coverage]
description = Run tests and generate coverage report
deps =
    {[testenv]deps}
commands =
    pytest --cov=custom_components.nwp500 \
           --cov-report=term-missing \
           --cov-report=html \
           --cov-report=xml \
           --cov-fail-under=80 \
           {posargs:tests/}

[testenv:coverage-html]
description = Generate HTML coverage report
deps =
    {[testenv]deps}
commands =
    pytest --cov=custom_components.nwp500 \
           --cov-report=html \
           {posargs:tests/}
    python -m webbrowser htmlcov/index.html

[testenv:hacs]
description = Validate HACS requirements
deps =
skip_install = True
allowlist_externals =
    python
commands =
    python validate_hacs.py
