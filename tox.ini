[tox]
envlist = py313,mypy,basedpyright,ruff,coverage,hacs
skipsdist = True

[testenv]
description = Run unit tests with pytest
deps =
    pytest>=7.0.0
    pytest-asyncio>=0.21.0
    pytest-cov>=4.0.0
    pytest-homeassistant-custom-component>=0.13.0
    pytest-timeout>=2.1.0
    pycares<5.0.0
    homeassistant>=2025.1.0
    nwp500-python==7.4.5

[testenv:py313]
description = Run tests on Python 3.13
basepython = python3.13

[testenv:mypy]
description = Run mypy type checking
deps =
    mypy>=1.0.0
    homeassistant>=2025.1.0
    nwp500-python==7.4.5

[testenv:basedpyright]
description = Run basedpyright type checking
deps =
    basedpyright>=1.0.0
    homeassistant>=2025.1.0
    nwp500-python==7.4.5

[testenv:ruff]
description = Run ruff linting and formatting checks
deps =
    ruff>=0.1.0
skip_install = True
commands =
    ruff check custom_components/nwp500 tests
    ruff format --check custom_components/nwp500 tests

[testenv:coverage]
description = Run tests and generate coverage report
basepython = python3
deps =
    {[testenv]deps}
commands =
    pytest --cov=custom_components.nwp500 \
           --cov-report=term-missing \
           --cov-report=html \
           --cov-report=xml \
           --cov-fail-under=80 \
           {posargs:tests/}

[testenv:coverage-html]
description = Generate HTML coverage report
deps =
    {[testenv]deps}
commands =
    pytest --cov=custom_components.nwp500 \
           --cov-report=html \
           {posargs:tests/}
    python -m webbrowser htmlcov/index.html

[testenv:hacs]
description = Validate HACS requirements
deps =
skip_install = True
allowlist_externals =
    python
commands =
    python validate_hacs.py
